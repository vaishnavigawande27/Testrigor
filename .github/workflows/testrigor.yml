name: CI - testrigor (instant local test)

on:
  push:
    branches: [ main ]

jobs:
  run-local-testrigor:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install testrigor CLI
        run: |
          curl -sSf https://testrigor.com/install | bash
          export PATH=$PATH:$HOME/.testrigor/bin

      - name: Run login test locally
        run: |
          #!/bin/bash
          set -e
          # Run your test suite/test case locally
          testrigor run login_test.yaml
        continue-on-error: true

      - name: Slack notification on success
        if: success()
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{"text":"✅ Login test PASSED"}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Slack notification on failure
        if: failure()
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{"text":"❌ Login test FAILED"}' \
          ${{ secrets.SLACK_WEBHOOK_URL }}
